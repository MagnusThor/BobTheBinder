<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Bob The Binder - Todo App - example 1.0</title>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet" />

</head>
<body>


    <div class="container" id="app">
        <div class="row">
            <div class="col-xs-12">
                <h1>Simple realtime synced Todo's&nbsp;<small>Using Bob The Binder</small></h1>
            </div>
        </div>
        <hr />
        <div class="row">
            <div class="col-xs-12">
                <form id="todoForm" class="form">
                    
                    
                    <div class="input-group">
                       
                        <input type="text" id="task" name="task" data-bind="value:todo.task" class="form-control" placeholder="What to do?" />
                        <span class="input-group-btn">
                            <button data-bind="click:addTodo" class="btn btn-default">Add</button>
                        </span>

                    </div>

                 

                   
                  
              
                    
                </form>
            </div>
        </div>
        <hr />
        <div class="row">

            <div class="col-xs-12">
                <table class="table table-striped table-responsive table-hover">
                    <thead>
                        <tr>
                            <th>Task</th>
                            <th>Completed</th>
                            <th>Created</th>
                            <th>Remove</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-repeat="todos">
                            <td><span data-bind="text:task"></span></td>
                            <td>
                                <input type="checkbox" data-bind="checkchange:completed,checked:completed" class="checkbox" />
                            </td>

                            <td>
                                <span data-bind="text:id"></span>
                            </td>

                            <td>

                                <i class="glyphicon glyphicon-remove" data-bind="click:$root.removeTodo"></i>


                            </td>


                        </tr>

                    </tbody>

                </table>
            </div>

        </div>
        
        <div class="row">
            <div class="col-xs-12">
                <div class="alert alert-info">
                    Open a second browser window, so you will see how the information is synced in real time.
                </div>
                
                <hr/>
                More info about Bob The Binder on - <a href="https://github.com/MagnusThor/BobTheBinder/wiki">https://github.com/MagnusThor/BobTheBinder/wiki</a>

            </div>
        </div>

    </div>

    
    <script src="//cdn.rawgit.com/jdarling/Object.observe/master/Object.observe.poly.js"></script>
    <script src="//cdn.rawgit.com/Polymer/observe-js/master/src/observe.js"></script>
    

    <script src="//cdn.rawgit.com/XSockets/XSockets.Clients/master/src/XSockets.Clients/XSockets.JavaScript/XSockets.latest.js"></script>
    <script src="//cdn.rawgit.com/MagnusThor/BobTheBinder/master/src/bob.latest.js"></script>
    <script src="js/models.js"></script>

    <script>
        var ws, vm, app;

        document.addEventListener("DOMContentLoaded", function () {


            vm = new TodoViewModel({
                onadd: function () {
                    ws.controller("generic").invoke("add", this);
                },
                ondelete: function () {
                    ws.controller("generic").invoke("remove", this);
                }
            });

            ws = new XSockets.WebSocket("ws://hushhash.net:80", ["generic"]);



            app = Bob.apply();

            app.bind($("#app"), vm);

            // attach a notifier for the 'Todos' collection (array )

            app.on(vm.todos).add(function (addedTodo) {

                app.on(addedTodo).update(function (todo, name, type, old, binder) {
                    // lets check what binder caused the notification, just verify the binder(source)  'checkchange' event
                    if (binder === "checkchange")
                        ws.controller("generic").invoke("completedChange", todo);
                });
            });

            ws.controller("generic").on("completedChange", function (todo) {
                var match = vm.todos.findIndex(function (t) {
                    return t.id === todo.id;
                });
                if (match >= 0) {
                    vm.todos[match].completed = todo.completed;;
                }
            });
            ws.controller("generic").on("add", function (todo) {
                vm.todos.push(todo);
            });
            ws.controller("generic").on("remove", function (todo) {
                var index = vm.todos.findIndex(function (t) {
                    return t.id === todo.id;
                });
                vm.todos.splice(index, 1);
            });

        });
    </script>

</body>
</html>
