var $=$||function(n,t){t||(t=document);var i=arguments;return i.length===0?t:typeof arguments[0]=="function"?(t.addEventListener("DOMContentLoaded",function(n){i[0].call(this,n)}),t):t.querySelector(n)},Bob=Bob||{},getExpression;Bob.Guid={newGuid:function(n,t){for(t=n="";n++<36;t+=n*51&52?(n^15?8^Math.random()*(n^20?16:4):4).toString(16):"-");return t}};getExpression=function(n){var i=n.split(".").first(),r=i.match(/\((.*?)\)/),t;return r&&(i=i.replace(r[0],"")),t=i.replace(/[()]/g,""),t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,""),{prop:t,args:r,isFn:r===null?!1:!0}};Bob.serializeForm=function(n){n||(n=this);var r,i,f,t,u;for(r={},u=n.elements,i=0,f=u.length;i<f;i++)t=u[i],!t.disabled&&t.name&&(r[t.name]=t.value);return r};Bob.binders={registerBinder:function(n,t,i){if(this.hasOwnProperty(n))throw"Binder name already exists '"+n+"'";else this[n]=t;return i&&i(),this},hide:function(n){return{updateProperty:function(t){n.style.display=t?"":"none"}}},css:function(n){var t;return{updateProperty:function(i){(typeof i=="function"&&(i=i()),i)&&(t?t.split(",").forEach(function(t){n.classList.remove(t)}):i.split(",").forEach(function(t){n.classList.remove(t)}),n.classList.add(i),t=i)}}},value:function(n,t){return n.addEventListener("keyup",function(){t(n.value)}),{updateProperty:function(t){t!==n.value&&(n.value=t)}}},count:function(n){return{updateProperty:function(t){n.textContent=String(t).length}}},html:function(n){return{updateProperty:function(t){n.htmlText=t}}},href:function(n){return{updateProperty:function(t){n.setAttribute("href",t)}}},domId:function(n){return{updateProperty:function(t){n.setAttribute("id",t)}}},input:function(n){return{updateProperty:function(){var t=arguments,i=function(){t[0].apply(t[0](),[JSON.stringify(t[2])])};n.addEventListener("input",i)}}},dataset:function(n){return{updateProperty:function(t){n.dataset[t]=t}}},text:function(n){return{updateProperty:function(t){n.textContent=t}}},selectchange:function(n,t,i,r){var u;return{updateProperty:function(){var f=arguments,t;u=f[5];t=function(n){for(var f=n.target.querySelectorAll("option"),t=0;t<f.length;t++)f[t].selected||r(u[t]);for(t=0;t<f.length;t++)f[t].selected&&i(u[t])};n.addEventListener("change",t)}}},select:function(n){return{updateProperty:function(){var t=arguments,r,u,i;if(Array.isArray(t[0]))r=t[0],u=r.findIndex(function(n){return JSON.stringify(n)==JSON.stringify(t[3])}),u>-1&&(n.selected=!0);else{if(i=t[0],t[3]){JSON.stringify(i)===JSON.stringify(t[3])&&(n.selected=!0);return}n.selected=i==n.value?!0:!1}}}},checkchange:function(n,t,i,r){var u,f,e;return{updateProperty:function(){var s=arguments,o;f=s[3];e||(e=typeof s[0]=="boolean");o=function(){e?t(n.checked):n.checked?i(f):r(f)};u&&n.removeEventListener("click",u);u=o;n.addEventListener("click",o)}}},checked:function(n){return{updateProperty:function(){var t=arguments;if(Array.isArray(t[0]))throw"Not yet implemented";else n.checked=t[0]}}},validate:function(n){var t=n.dataset.pattern;return{updateProperty:function(){}}},click:function(n){var t,i;return{updateProperty:function(r){i||(i=this);var u=function(n){r.apply(i,[n])};t&&n.removeEventListener("click",t);t=u;n.addEventListener("click",u)}}}};Bob.Notifier=function(){return function(){var n=[];this.name=undefined;this.on=function(t,i,r){return t.hasOwnProperty("$bob")?t.$bob:(t.$bob=new Bob.Dispatcher(i,r),n.push(t.$bob),t.$bob)};this.clone=function(t,i){i.$bob=n.findBy(function(n){return n.name===t}).first()};this.off=function(t,i){var r=n.findIndex(function(n){return n.name===t});n.splice(r,1);i&&i()}}}();Bob.Dispatcher=function(){var n=function(n,t,i){this.name=n;this.fn=i};return n.prototype.add=function(n){return this.$add=n,this},n.prototype.update=function(n){return this.$update=n,this},n.prototype.delete=function(n){return this.$delete=n,this},n}();Bob.apply=function(n){function t(n,r){if(r.indexOf("$this").length>0)return n;var f=r.split("."),u=getExpression(f[0]),e=new RegExp("^\\$root").test(u.prop);return e?t(i,f.slice(1).join("."),r):f.length==1?u.isFn?n[u.prop].apply(n,u.args[1].split(",")):typeof n[u.prop]=="object"?n[u.prop]:n:u.isFn?t(n[u.prop].apply(n,u.args[1].split(",")),f.slice(1).join("."),r):t(n[u.prop],f.slice(1).join("."),r)}function f(r,u,f,o){var s=t(f,o),c,h;r.dataset.attr&&e(r,s);h=o.split("|");o=h[0];h=h.slice(1);var y=function(n){if(s[o.split(".").pop()])s[o.split(".").pop()]=n;else if(Array.isArray(s)){var t=s.findIndex(function(t){return JSON.stringify(t)===JSON.stringify(n)});s.remove(t)}},p=function(n,t){var r,i;if(t||(t=o),s[t.split(".").pop()])throw"Not yet implemented";else if(Array.isArray(s))r=s.findIndex(function(t){return JSON.stringify(t)===JSON.stringify(n)}),r===-1&&s.push(n);else for(i in n)s[i]=n[i]},w=function(n,t){t||(t=o);s[t.split(".").pop()]=n;return},v=n[u](r,w,p,y,f),l=o.split(".").pop();l=l.replace("(","").replace(")","");r.dataset.with&&h.length===0?c=t(i,r.dataset.with):h.length>1&&(c=t(i,h[0]));v.updateProperty.apply(f,[s.hasOwnProperty(l)?s[l]:s,u,s,f,h,c]);var a=function(n){var i=s.$bob,e=n.some(function(n){return n.name===o.split(".").pop()}),t,r;e&&(t=n.first(),r=t.object,i&&(i.hasOwnProperty("$"+t.type)&&i["$"+t.type].apply(t.object,[r,t.name,t.type,t.oldValue,u]),i.fn&&i.fn.apply(i,[r,t.name,t.type,t.oldValue,u]),i.type=t.type),v.updateProperty(s[l],u,s,f,h,c));typeof s[l]!="function"||e||v.updateProperty(s[l],u,s,f,h,c)},b=function(){Object.observe(s,a)},k=function(){Object.unobserve(s,a)};return typeof s=="object"&&(Object.observe(s,a),Object.observe(s,function(n){n.forEach(function(t){var i=n.some(function(n){return n.key===o.split(".").pop()});t.type==="$update"&&i&&(Object.unobserve(s,a),v.updateProperty(t.$object[t.key],u,t.object,f,h,c),Object.observe(s,a))})},["$update"])),{propertyName:o,$binder:function(n,t){Object.unobserve(s,a);v.updateProperty(n,u,t,f,h,c);Object.observe(s,a)},observe:b,unobserve:k}}function e(n,t){var u,f,i;if(typeof t=="object")return u=function(i){var u=n.dataset.attr.split(",");return u.forEach(function(n){var r=n.split(":");switch(r[0]){case"innerText":i.textContent=t[r[1]];break;default:i.setAttribute(r[0],t[r[1]])}}),r(n,t)},f=function(i,u){var f=n.dataset.attr.split(",");return f.forEach(function(n){var f=n.split(":"),r,e;f[0]==="text"?i.textContent=u[f[1]]:(r=f[1].split(".").pop(),r&&(r=r.replace("(","").replace(")","")),e=typeof t[r]=="function",i.setAttribute(f[0],e?t[r]():t[f[1].split(".").pop()]))}),r(n,u)},u(n),i=function(t){f(n,t[0].object)},Object.observe(t,i),{unobserve:function(){Object.unobserve(t,i)},observe:function(){Object.observe(t,i)}}}function s(n,t){function s(n){var t=n.previousSibling,i=n.parentNode,r=n.cloneNode(!0);return n.parentNode.removeChild(n),{insert:function(){var n=r.cloneNode(!0);return i.insertBefore(n,t),n}}}n.dataset.parent=n.dataset.repeat;delete n.dataset.repeat;var f=n.parentNode,h=s(n),o=function(i){var u=h.insert(),f=r(u,i,t);return n.dataset.attr&&e(u,i),f},u=t.map(function(n){return o(n)}),i=function(n){var i=t.$bob,e=n.findIndex(function(n){return n.type==="delete"});e>=0&&i&&i.hasOwnProperty("$delete")&&i.$delete.apply(n[0].oldValue,[n[0].oldValue,n[0].name,"delete"]);n.forEach(function(n){var e=parseInt(n.name,10),h,s;isNaN(e)||(s=isNaN(e)?n.object:n.object[e],s||(s=n.object),n.type==="add"?(i&&i.hasOwnProperty("$add")&&i["$"+n.type].apply(n.object,[s,n.name,n.type,n.oldvalue]),u.push(o(t[e]))):n.type==="update"?(u[e].unobserve(),r(f.children[e],t[e])):n.type==="delete"&&(h=f.children[e],h.parentNode.removeChild(h)))})},c=function(){Object.unobserve(t,i)},l=function(){Object.observe(t,i)};return Object.observe(t,i),Object.observe(t,function(n){n.forEach(function(n){var r,h,e,c,s;n.type==="$add"?(h=n.$object,Object.unobserve(t,i),r=t.push(h),u.push(o(t[r-1])),Object.observe(t,i)):n.type==="$delete"?(c=n.$object,r=t.findIndex(function(n){return JSON.stringify(n)===JSON.stringify(c)}),e=f.children[r],e.parentNode.removeChild(e),Object.unobserve(t,i),t.remove(r),Object.observe(t,i)):n.type==="$update"&&(r=t.findIndex(function(t){return t[n.key]===n.oldValue}),u[r]&&(s=u[r].bindings.findBy(function(t){if(t)return t.first().propertyName===n.key})),t[r][n.key]=n.$object[n.key],Object.observe(t,i),s&&s.forEach(function(t){var i=t.first().$binder;i.apply(n,[n.$object[n.key],n.$object])}))})},["$add","$delete","$update"]),{unobserve:c,observe:l}}function r(n,r){function o(n){for(n=n.parentElement;n;){if(n.dataset.repeat)return!1;n=n.parentElement}return!0}function e(t){var i=n.querySelectorAll(t);return Array.prototype.filter.call(i,o)}typeof n=="string"&&(n=document.querySelector(n));i||(i=r);var u=e("[data-bind]").map(function(n){var t=n.dataset.bind;return t.split(",").map(function(i){var u=i.substr(0,i.indexOf(":")),e=i.substr(u.length+1,i.length);return f(n,u,r,e,t)})}).concat(e("[data-repeat]").map(function(n){var i=t(r,n.dataset.repeat);return s(n,i)})).concat([n].map(function(n){var t=n.dataset.bind;if(t)return t.split(",").forEach(function(i){var u=i.substr(0,i.indexOf(":")),e=i.substr(u.length+1,i.length);return f(n,u,r,e,t)})}));return{bindings:u,unobserve:function(){u.forEach(function(n){n&&n.hasOwnProperty("unobserve")&&n.unobserve()})},observe:function(){u.forEach(function(n){n.observe()})}}}n||(n=Bob.binders);var o=Bob.Guid.newGuid(),i,u=new Bob.Notifier;return{on:function(){return u.on.apply(this,arguments)},off:function(){return u.off.apply(this,arguments)},$instanceId:o,notifier:u,bind:r,$root:function(){return i}}};Array.prototype.intersect=function(n){for(var f=[],t=this.slice(0),i=n.slice(0),r=t.length-1,u=i.length-1;r>=0&&u>=0;)t[r]>i[u]?(t.pop(),r--):t[r]<i[u]?(i.pop(),u--):(f.push(t.pop()),i.pop(),r--,u--);return f};Array.prototype.first=function(n){return n?(n<0&&(n=0),this.slice(0,n)):this[0]};Array.prototype.take=function(n){return n||(n=2),this.filter(function(t,i){if(i<n)return t})||[]};Array.prototype.findBy=function(n){for(var i=this,r=[],t=0;t<i.length;t++)n(i[t])&&r.push(i[t]);return r};Array.prototype.count=function(n){var r=this,i=0,t;if(!n)return this.length;for(t=0;t<this.length;t++)n(r[t])&&i++;return i};Array.prototype.findIndex=function(n){for(var i=this,t=0;t<this.length;t++)if(n(i[t]))return t;return-1};Array.prototype.remove=function(n){return this.splice(n,1),this.length};Array.prototype.clone=function(){return this.slice(0)};Array.prototype.removeAll=function(){for(var n=0;this.length;n++)this.splice(n,1);return this.length};Object.defineProperties(Object,{extend:{configurable:!0,enumerable:!1,value:function(n,t){var i,r=Object.keys(t);return i=Object.keys(n).length?Object.clone(n):{},r.forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))}),i},writable:!0},clone:{configurable:!0,enumerable:!1,value:function(n){return Object.extend({},n)},writable:!0}});
//# sourceMappingURL=bob.latest.min.js.map
